<VirtualHost *:80>
    ServerName <%= @params[:server_name] %>
    <% if @params[:server_aliases].count %>ServerAlias <% @params[:server_aliases].each do |a| %><%= "#{a}" %> <% end %><% end %>
    DocumentRoot <%= @params[:docroot] %>

    <Directory <%= @params[:docroot] %>>
        Options FollowSymLinks
        AllowOverride All
        Order allow,deny
        Allow from all
    </Directory>

    LogLevel info
    ErrorLog <%= @node[:apache][:log_dir] %>/<%= @params[:name] %>-error.log
    
    LogFormat "%h %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-Agent}i\"" combined
    LogFormat "%{X-Forwarded-For}i %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-Agent}i\"" proxy
    SetEnvIf X-Forwarded-For "^.*\..*\..*\..*" forwarded
    CustomLog <%= @node[:apache][:log_dir] %>/<%= @params[:name] %>-access.log combined env=!forwarded
    CustomLog <%= @node[:apache][:log_dir] %>/<%= @params[:name] %>-access.log proxy env=forwarded

    SetEnv ENVIRONMENT <%= @params[:environment] %>
</VirtualHost>